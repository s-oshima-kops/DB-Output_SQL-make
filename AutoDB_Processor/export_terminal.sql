-- ====================================================================
-- 【端末マスタ情報エクスポート用SQLスクリプト】
-- 機能: Oracle データベースから端末マスタ情報をCSV形式で出力
-- 作成者: システム管理部
-- 更新日: 2024-01-01
-- 
-- 【重要】現場のテーブル構造に合わせて以下を修正してください:
-- 1. テーブル名 (MST_Terminal)
-- 2. カラム名 (terminal_id, terminal_name など)
-- 3. WHERE条件 (必要に応じて)
-- 4. ORDER BY条件
-- ====================================================================

-- ====================================================================
-- 【SQL*Plusの出力設定】 
-- ※この部分は通常変更不要です
-- ====================================================================
SET PAGESIZE 0          -- ページヘッダーを表示しない
SET LINESIZE 1000       -- 1行の最大文字数（長い行がある場合は増やす）
SET COLSEP ','          -- カラム区切り文字をカンマに設定
SET TRIMSPOOL ON        -- 行末の空白を削除
SET HEADSEP OFF         -- ヘッダーとデータの区切り線を表示しない
SET FEEDBACK OFF        -- 「XX行が選択されました」等のメッセージを表示しない
SET ECHO OFF            -- 実行したSQL文を画面に表示しない
SET VERIFY OFF          -- 変数置換の確認メッセージを表示しない

-- ====================================================================
-- 【CSV出力開始】
-- ====================================================================
SPOOL AutoDB_output/mst_terminal.csv

-- ヘッダー行の出力
-- ※現場のカラム名に合わせて修正してください
SELECT 'TERMINAL_ID,TERMINAL_NAME,APP_CODE,AREA,TEAM_NAME,UPDATE_TIMESTAMP' FROM DUAL;

-- ====================================================================
-- ★★★ ここを現場のテーブル構造に合わせて修正してください ★★★
-- 修正が必要な箇所を <<<>>> で囲んでいます
-- ====================================================================

SELECT 
    -- ┌─────────────────────────────────┐
    -- │ 📊 カラム設定（現場のテーブルに合わせて変更） │
    -- └─────────────────────────────────┘
    
    -- カラム1: 端末ID（主キー）
    <<<terminal_id>>> || ',' ||
    -- ↑ 実際のテーブルの端末IDカラム名に変更
    --   例: terminal_id → device_id
    
    -- カラム2: 端末名  
    <<<terminal_name>>> || ',' ||
    -- ↑ 実際のテーブルの端末名カラム名に変更
    --   例: terminal_name → device_name
    
    -- カラム3: アプリケーションコード
    <<<app_code>>> || ',' ||
    -- ↑ 実際のテーブルのアプリコードカラム名に変更
    --   例: app_code → application_code
    
    -- カラム4: 利用エリア
    <<<area>>> || ',' ||
    -- ↑ 実際のテーブルのエリアカラム名に変更
    --   例: area → location
    
    -- カラム5: チーム名
    <<<team_name>>> || ',' ||
    -- ↑ 実際のテーブルのチーム名カラム名に変更  
    --   例: team_name → department
    
    -- カラム6: 更新日時（日付フォーマット調整可能）
    TO_CHAR(<<<update_timestamp>>>, 'YYYY-MM-DD HH24:MI:SS')
    -- ↑ 実際のテーブルの更新日時カラム名に変更
    --   例: update_timestamp → last_update_date

FROM <<<MST_Terminal>>>    
-- ↑ 【重要】実際のテーブル名に変更してください
--   例: MST_Terminal → TERMINAL_MASTER

-- ====================================================================
-- 【条件指定】必要に応じて WHERE条件を追加
-- ====================================================================
-- WHERE 条件が必要な場合は以下のコメントアウトを外して使用
-- WHERE active_flag = '1'                      -- アクティブなレコードのみ
-- WHERE area IN ('東京', '大阪', '名古屋')       -- 特定エリアのみ  
-- WHERE update_timestamp >= SYSDATE - 30       -- 30日以内に更新されたもの
-- WHERE <<<追加の条件>>>                       -- 現場固有の条件

-- ====================================================================
-- 【並び順指定】必要に応じて ORDER BY を変更  
-- ====================================================================
ORDER BY <<<terminal_id>>>;    
-- ↑ 並び順の基準カラム名を実際のカラム名に変更
--   例: terminal_id → device_id

-- ====================================================================
-- 【CSV出力終了】
-- ====================================================================
SPOOL OFF

-- 処理完了メッセージ
SELECT 'エクスポート処理が完了しました。' AS MESSAGE FROM DUAL;

-- ====================================================================
-- 【接続終了】
-- ====================================================================
EXIT; 